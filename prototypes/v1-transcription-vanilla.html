<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protein Folding Game - Prototype v1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #111827;
            color: #fff;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 1rem;
            gap: 1rem;
        }

        .header {
            margin-bottom: 0.5rem;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #9ca3af;
        }

        .main-content {
            display: flex;
            gap: 1rem;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 256px;
            background: #1f2937;
            border-radius: 0.5rem;
            padding: 1rem;
            overflow-y: auto;
        }

        .section {
            margin-bottom: 1.5rem;
        }

        .section h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .objective-text {
            font-size: 0.875rem;
            color: #9ca3af;
            margin-bottom: 0.5rem;
        }

        .sequence-box {
            background: #111827;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }

        .sequence-label {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .nucleotide-container {
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
        }

        .nucleotide {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-family: monospace;
            font-weight: bold;
        }

        .tool-button {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 0.25rem;
            background: #374151;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 0.5rem;
            transition: background 0.2s;
        }

        .tool-button:hover {
            background: #4b5563;
        }

        .tool-button.selected {
            background: #7c3aed;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .stats-label {
            color: #9ca3af;
        }

        .output-box {
            background: #111827;
            padding: 0.5rem;
            border-radius: 0.25rem;
            min-height: 3rem;
        }

        .success-box {
            background: #064e3b;
            border: 2px solid #10b981;
            border-radius: 0.25rem;
            padding: 0.75rem;
            text-align: center;
        }

        .success-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .success-stats {
            font-size: 0.75rem;
        }

        .canvas-container {
            flex: 1;
            background: #1f2937;
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .control-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.25rem;
            color: white;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s;
        }

        .btn-run {
            background: #2563eb;
        }

        .btn-run:hover:not(:disabled) {
            background: #1d4ed8;
        }

        .btn-reset {
            background: #4b5563;
        }

        .btn-reset:hover {
            background: #374151;
        }

        .btn-clear {
            background: #dc2626;
        }

        .btn-clear:hover {
            background: #b91c1c;
        }

        .control-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        canvas {
            border: 1px solid #374151;
            border-radius: 0.25rem;
            cursor: crosshair;
            background: #1a1a2e;
        }

        .hint-text {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: #9ca3af;
        }

        .icon {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Protein Folding Game - Prototype v1</h1>
            <p>DNA Transcription Puzzle</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="section">
                    <h3>Objective</h3>
                    <p class="objective-text">Transcribe the DNA sequence into RNA</p>
                    <div class="sequence-box">
                        <div class="sequence-label">DNA Input:</div>
                        <div class="nucleotide-container" id="dna-display"></div>
                        <div class="sequence-label" style="margin-top: 0.5rem;">Target RNA:</div>
                        <div class="nucleotide-container" id="target-display"></div>
                    </div>
                </div>

                <div class="section">
                    <h3>Tools</h3>
                    <button class="tool-button" id="tool-polymerase">RNA Polymerase</button>
                </div>

                <div class="section">
                    <h3>Stats</h3>
                    <div class="stats-row">
                        <span class="stats-label">Cycles:</span>
                        <span id="stat-cycles">0</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Machines:</span>
                        <span id="stat-machines">0</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Area:</span>
                        <span id="stat-area">0</span>
                    </div>
                </div>

                <div class="section">
                    <h3>Output</h3>
                    <div class="output-box">
                        <div class="nucleotide-container" id="output-display"></div>
                    </div>
                </div>

                <div id="success-box" style="display: none;">
                    <div class="success-box">
                        <div class="success-title">âœ“ Solved!</div>
                        <div class="success-stats">
                            <div>Cycles: <span id="final-cycles">0</span></div>
                            <div>Machines: <span id="final-machines">0</span></div>
                            <div>Area: <span id="final-area">0</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="canvas-container">
                <div class="controls">
                    <button class="control-button btn-run" id="btn-run" disabled>
                        <svg class="icon" viewBox="0 0 24 24">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        <span id="run-text">Run</span>
                    </button>
                    <button class="control-button btn-reset" id="btn-reset">
                        <svg class="icon" viewBox="0 0 24 24">
                            <polyline points="1 4 1 10 7 10"></polyline>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                        </svg>
                        Reset
                    </button>
                    <button class="control-button btn-clear" id="btn-clear">
                        <svg class="icon" viewBox="0 0 24 24">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                        Clear
                    </button>
                </div>

                <canvas id="game-canvas" width="800" height="600"></canvas>

                <div class="hint-text" id="hint-text">
                    Select a tool from the left panel to start building
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game constants
        const GRID_SIZE = 40;
        const NUCLEOTIDES = {
            A: { color: '#ef4444', complement: 'U' },
            T: { color: '#3b82f6', complement: 'A' },
            G: { color: '#10b981', complement: 'C' },
            C: { color: '#f59e0b', complement: 'G' }
        };

        // Game state
        const gameState = {
            machines: [],
            molecules: [],
            selectedTool: null,
            isRunning: false,
            cycle: 0,
            dnaSequence: ['A', 'T', 'G', 'C', 'T', 'A', 'G'],
            targetRNA: ['U', 'A', 'C', 'G', 'A', 'U', 'C'],
            producedRNA: [],
            animationFrame: null,
            lastCycleTime: 0
        };

        // DOM elements
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const btnRun = document.getElementById('btn-run');
        const btnReset = document.getElementById('btn-reset');
        const btnClear = document.getElementById('btn-clear');
        const toolPolymerase = document.getElementById('tool-polymerase');
        const hintText = document.getElementById('hint-text');
        const successBox = document.getElementById('success-box');

        // Initialize displays
        function initDisplays() {
            const dnaDisplay = document.getElementById('dna-display');
            const targetDisplay = document.getElementById('target-display');

            gameState.dnaSequence.forEach(base => {
                const span = document.createElement('span');
                span.className = 'nucleotide';
                span.textContent = base;
                span.style.backgroundColor = NUCLEOTIDES[base].color;
                dnaDisplay.appendChild(span);
            });

            gameState.targetRNA.forEach(base => {
                const span = document.createElement('span');
                span.className = 'nucleotide';
                span.textContent = base;
                span.style.backgroundColor = '#374151';
                targetDisplay.appendChild(span);
            });
        }

        // Update stats display
        function updateStats() {
            document.getElementById('stat-cycles').textContent = gameState.cycle;
            document.getElementById('stat-machines').textContent = gameState.machines.length;
            document.getElementById('stat-area').textContent = calculateArea();
        }

        // Calculate area
        function calculateArea() {
            if (gameState.machines.length === 0) return 0;
            const xs = gameState.machines.map(m => m.x);
            const ys = gameState.machines.map(m => m.y);
            const width = Math.max(...xs) - Math.min(...xs) + 1;
            const height = Math.max(...ys) - Math.min(...ys) + 1;
            return width * height;
        }

        // Update output display
        function updateOutput() {
            const outputDisplay = document.getElementById('output-display');
            outputDisplay.innerHTML = '';
            
            gameState.producedRNA.forEach(base => {
                const span = document.createElement('span');
                span.className = 'nucleotide';
                span.textContent = base;
                const nucleotide = Object.values(NUCLEOTIDES).find(n => n.complement === base);
                span.style.backgroundColor = nucleotide ? nucleotide.color : '#ffffff';
                outputDisplay.appendChild(span);
            });
        }

        // Tool selection
        toolPolymerase.addEventListener('click', () => {
            gameState.selectedTool = 'rna_polymerase';
            toolPolymerase.classList.add('selected');
            hintText.textContent = 'Click on the grid to place: RNA POLYMERASE';
        });

        // Canvas click handler
        canvas.addEventListener('click', (e) => {
            if (!gameState.selectedTool || gameState.isRunning) return;

            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / GRID_SIZE);
            const y = Math.floor((e.clientY - rect.top) / GRID_SIZE);

            // Check if occupied
            const occupied = gameState.machines.some(m => m.x === x && m.y === y);
            if (occupied) return;

            // Add machine
            gameState.machines.push({
                id: Date.now(),
                type: gameState.selectedTool,
                x: x,
                y: y
            });

            updateStats();
            btnRun.disabled = false;
            draw();
        });

        // Run/Pause button
        btnRun.addEventListener('click', () => {
            gameState.isRunning = !gameState.isRunning;
            if (gameState.isRunning) {
                document.getElementById('run-text').textContent = 'Pause';
                btnRun.querySelector('.icon').innerHTML = '<rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect>';
                gameState.lastCycleTime = Date.now();
                gameLoop();
            } else {
                document.getElementById('run-text').textContent = 'Run';
                btnRun.querySelector('.icon').innerHTML = '<polygon points="5 3 19 12 5 21 5 3"></polygon>';
            }
        });

        // Reset button
        btnReset.addEventListener('click', () => {
            gameState.isRunning = false;
            gameState.cycle = 0;
            gameState.molecules = [];
            gameState.producedRNA = [];
            gameState.lastCycleTime = 0;
            successBox.style.display = 'none';
            document.getElementById('run-text').textContent = 'Run';
            btnRun.querySelector('.icon').innerHTML = '<polygon points="5 3 19 12 5 21 5 3"></polygon>';
            updateStats();
            updateOutput();
            draw();
        });

        // Clear button
        btnClear.addEventListener('click', () => {
            gameState.machines = [];
            btnReset.click();
            btnRun.disabled = true;
            updateStats();
            draw();
        });

        // Game loop
        function gameLoop() {
            if (!gameState.isRunning) return;

            const now = Date.now();
            if (now - gameState.lastCycleTime >= 500) {
                gameState.lastCycleTime = now;
                
                // Process cycle
                if (gameState.cycle < gameState.dnaSequence.length) {
                    const polymerases = gameState.machines.filter(m => m.type === 'rna_polymerase');
                    
                    if (polymerases.length > 0) {
                        const nucleotide = gameState.dnaSequence[gameState.cycle];
                        const rnaBase = NUCLEOTIDES[nucleotide].complement;
                        gameState.producedRNA.push(rnaBase);
                        
                        const poly = polymerases[0];
                        gameState.molecules.push({
                            id: Date.now(),
                            base: rnaBase,
                            x: poly.x * GRID_SIZE + GRID_SIZE / 2,
                            y: poly.y * GRID_SIZE + GRID_SIZE / 2,
                            targetY: poly.y * GRID_SIZE + GRID_SIZE * 3
                        });
                    }
                    
                    gameState.cycle++;
                    updateStats();
                    updateOutput();
                }

                // Check win condition
                if (gameState.producedRNA.length === gameState.targetRNA.length) {
                    const isCorrect = gameState.producedRNA.every((base, i) => base === gameState.targetRNA[i]);
                    if (isCorrect) {
                        gameState.isRunning = false;
                        document.getElementById('run-text').textContent = 'Run';
                        btnRun.querySelector('.icon').innerHTML = '<polygon points="5 3 19 12 5 21 5 3"></polygon>';
                        showSuccess();
                    }
                }
            }

            // Update molecules
            gameState.molecules = gameState.molecules.map(mol => ({
                ...mol,
                y: mol.y < mol.targetY ? mol.y + 2 : mol.y
            })).filter(mol => mol.y <= canvas.height);

            draw();
            requestAnimationFrame(gameLoop);
        }

        // Show success
        function showSuccess() {
            successBox.style.display = 'block';
            document.getElementById('final-cycles').textContent = gameState.cycle;
            document.getElementById('final-machines').textContent = gameState.machines.length;
            document.getElementById('final-area').textContent = calculateArea();
        }

        // Draw function
        function draw() {
            // Clear canvas
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            ctx.strokeStyle = '#2a2a3e';
            ctx.lineWidth = 1;
            for (let x = 0; x <= canvas.width; x += GRID_SIZE) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y <= canvas.height; y += GRID_SIZE) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            // Draw machines
            gameState.machines.forEach(machine => {
                const x = machine.x * GRID_SIZE;
                const y = machine.y * GRID_SIZE;

                if (machine.type === 'rna_polymerase') {
                    ctx.fillStyle = '#8b5cf6';
                    ctx.beginPath();
                    for (let i = 0; i < 6; i++) {
                        const angle = (Math.PI / 3) * i;
                        const px = x + GRID_SIZE / 2 + Math.cos(angle) * GRID_SIZE / 3;
                        const py = y + GRID_SIZE / 2 + Math.sin(angle) * GRID_SIZE / 3;
                        if (i === 0) ctx.moveTo(px, py);
                        else ctx.lineTo(px, py);
                    }
                    ctx.closePath();
                    ctx.fill();
                    ctx.strokeStyle = '#a78bfa';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            });

            // Draw molecules
            gameState.molecules.forEach(mol => {
                const nucleotide = Object.values(NUCLEOTIDES).find(n => n.complement === mol.base);
                const baseColor = nucleotide ? nucleotide.color : '#ffffff';
                
                ctx.fillStyle = baseColor;
                ctx.beginPath();
                ctx.arc(mol.x, mol.y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px monospace';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(mol.base, mol.x, mol.y);
            });
        }

        // Initialize
        initDisplays();
        updateStats();
        draw();
    </script>
</body>
</html>
