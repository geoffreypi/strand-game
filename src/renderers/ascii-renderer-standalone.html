<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Renderer Test</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a2e;
            color: #ffffff;
            padding: 20px;
            line-height: 1.6;
        }
        .output {
            background: #0f0f1e;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        h2 {
            color: #00ff88;
            margin-top: 30px;
        }
        pre {
            margin: 10px 0;
            white-space: pre;
        }
        .input-section {
            background: #16213e;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        input, textarea {
            font-family: 'Courier New', monospace;
            background: #0f0f1e;
            color: #ffffff;
            border: 1px solid #00ff88;
            padding: 8px;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
            margin: 5px 0;
        }
        button {
            background: #00ff88;
            color: #0f0f1e;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            margin: 5px 5px 5px 0;
        }
        button:hover {
            background: #00dd77;
        }
    </style>
</head>
<body>
    <h1>ðŸ§¬ ASCII Renderer Test</h1>
    <p>Quick visualization of molecular structures</p>

    <div class="output">
        <h2>Examples</h2>
        <div id="examples"></div>
    </div>

    <div class="input-section">
        <h2>Try Your Own</h2>
        
        <h3>DNA</h3>
        <label>Top Strand (3'â†’5'):</label>
        <input type="text" id="dna-top" value="ACGTACGT" />
        <label>Bottom Strand (5'â†’3'):</label>
        <input type="text" id="dna-bottom" value="TGCATGCA" />
        <button onclick="renderCustomDNA()">Render DNA</button>
        <pre id="dna-output"></pre>

        <h3>RNA</h3>
        <label>Sequence:</label>
        <input type="text" id="rna-seq" value="ACGUACGU" />
        <button onclick="renderCustomRNA()">Render RNA (Straight)</button>
        <label>Bend Position (0-indexed):</label>
        <input type="number" id="rna-bend" value="3" min="0" />
        <button onclick="renderCustomRNABend()">Render RNA (With Bend)</button>
        <pre id="rna-output"></pre>

        <h3>Protein</h3>
        <label>Amino Acid Sequence (use hyphens):</label>
        <input type="text" id="protein-seq" value="S-E60-BA-BG-RPF-CRL-C60" />
        <button onclick="renderCustomProtein()">Render Protein (Straight)</button>
        <label>Bend Position (0-indexed):</label>
        <input type="number" id="protein-bend" value="3" min="0" />
        <label>Bend Angle:</label>
        <select id="protein-angle">
            <option value="60">60Â°</option>
            <option value="120">120Â°</option>
        </select>
        <button onclick="renderCustomProteinBend()">Render Protein (With Bend)</button>
        <pre id="protein-output"></pre>
    </div>

    <script>
        // ASCII Renderer - Fast text-based visualization of molecular structures
        class ASCIIRenderer {
            
            // Render DNA structure
            static renderDNA(topSequence, bottomSequence) {
                if (topSequence.length !== bottomSequence.length) {
                    return "ERROR: Top and bottom sequences must be same length";
                }
                
                const length = topSequence.length;
                
                // Build top line with directional markers
                let topLine = "3'-" + topSequence.split('').join('-') + "-5'";
                
                // Build middle line with vertical bars linking each base pair
                let middleLine = "   ";  // Offset for alignment with "3'-"
                for (let i = 0; i < length; i++) {
                    middleLine += "|";
                    if (i < length - 1) {
                        middleLine += "   ";  // Space between bars (matches the dash spacing)
                    }
                }
                
                // Build bottom line with directional markers
                let bottomLine = "5'-" + bottomSequence.split('').join('-') + "-3'";
                
                return topLine + '\n' + middleLine + '\n' + bottomLine;
            }
            
            // Render RNA structure (straight)
            static renderRNA(sequence) {
                return "5'-" + sequence.split('').join('-') + "-3'";
            }
            
            // Render RNA with 60Â° bend
            static renderRNAWithBend(sequence, bendPosition) {
                if (bendPosition < 0 || bendPosition >= sequence.length - 1) {
                    return "ERROR: Invalid bend position";
                }
                
                let lines = [];
                
                // Before bend
                let beforeBend = sequence.substring(0, bendPosition + 1);
                lines.push("5'-" + beforeBend.split('').join('-'));
                
                // Calculate indent for the line before bend
                let baseIndent = "   " + " ".repeat(beforeBend.length * 2);
                
                // After bend (each base moves down and to the right)
                let afterBend = sequence.substring(bendPosition + 1);
                for (let i = 0; i < afterBend.length; i++) {
                    // Each successive base indents further right
                    let currentIndent = baseIndent + " ".repeat(i * 2);
                    
                    if (i === 0) {
                        lines.push(currentIndent + "\\");
                    }
                    
                    if (i === afterBend.length - 1) {
                        lines.push(currentIndent + " " + afterBend[i] + "-3'");
                    } else {
                        lines.push(currentIndent + " " + afterBend[i]);
                        lines.push(currentIndent + "  \\");
                    }
                }
                
                return lines.join('\n');
            }
            
            // Render protein structure (straight, unfolded)
            static renderProtein(aminoAcidSequence) {
                // aminoAcidSequence is like "S-E60-BA-RPF-C60"
                return "N-" + aminoAcidSequence + "-C";
            }
            
            // Render protein with bends
            static renderProteinWithBend(aminoAcidSequence, bendPosition, bendAngle) {
                const aminoAcids = aminoAcidSequence.split('-');
                
                if (bendPosition < 0 || bendPosition >= aminoAcids.length - 1) {
                    return "ERROR: Invalid bend position";
                }
                
                let lines = [];
                
                // Before bend
                let beforeBend = aminoAcids.slice(0, bendPosition + 1);
                lines.push("N-" + beforeBend.join('-'));
                
                // Calculate base indent
                let beforeBendStr = beforeBend.join('-');
                let baseIndent = "  " + " ".repeat(beforeBendStr.length + 1);
                
                // After bend (each amino acid moves down and to the right)
                let afterBend = aminoAcids.slice(bendPosition + 1);
                for (let i = 0; i < afterBend.length; i++) {
                    // Each successive amino acid indents further right
                    // Account for varying amino acid name lengths
                    let additionalIndent = 0;
                    for (let j = 0; j < i; j++) {
                        additionalIndent += afterBend[j].length + 1; // +1 for the dash or space
                    }
                    let currentIndent = baseIndent + " ".repeat(additionalIndent);
                    
                    if (i === 0) {
                        if (bendAngle === 60) {
                            lines.push(currentIndent + "\\");
                        } else if (bendAngle === 120) {
                            lines.push(currentIndent + "/");
                        }
                    }
                    
                    if (i === afterBend.length - 1) {
                        lines.push(currentIndent + " " + afterBend[i] + "-C");
                    } else {
                        lines.push(currentIndent + " " + afterBend[i]);
                        if (bendAngle === 60) {
                            lines.push(currentIndent + " " + " ".repeat(afterBend[i].length) + "\\");
                        } else {
                            lines.push(currentIndent + " " + " ".repeat(afterBend[i].length) + "/");
                        }
                    }
                }
                
                return lines.join('\n');
            }
            
            // Render hex grid structure (show q,r coordinates)
            static renderHexGrid(hexStructure) {
                // Find bounds
                let minQ = Infinity, maxQ = -Infinity;
                let minR = Infinity, maxR = -Infinity;
                
                for (const hex of hexStructure.hexes) {
                    minQ = Math.min(minQ, hex.q);
                    maxQ = Math.max(maxQ, hex.q);
                    minR = Math.min(minR, hex.r);
                    maxR = Math.max(maxR, hex.r);
                }
                
                let lines = [];
                
                // Build grid row by row
                for (let r = minR; r <= maxR; r++) {
                    let line = "";
                    
                    // Offset for hex grid
                    if (r % 2 === 1) {
                        line += "  ";
                    }
                    
                    for (let q = minQ; q <= maxQ; q++) {
                        const hex = hexStructure.hexes.find(h => h.q === q && h.r === r);
                        if (hex) {
                            line += hex.type + "   ";
                        } else {
                            line += ".   ";
                        }
                    }
                    
                    lines.push(line);
                }
                
                return lines.join('\n');
            }
        }

        // Run examples
        function runExamples() {
            const examples = document.getElementById('examples');
            
            let html = '';
            
            html += '<h3>DNA Structure</h3>';
            html += '<pre>' + ASCIIRenderer.renderDNA("ACGT", "TGCA") + '</pre>';
            
            html += '<h3>RNA Structure (straight)</h3>';
            html += '<pre>' + ASCIIRenderer.renderRNA("ACGUA") + '</pre>';
            
            html += '<h3>RNA Structure (with 60Â° bend at position 2)</h3>';
            html += '<pre>' + ASCIIRenderer.renderRNAWithBend("ACGUA", 2) + '</pre>';
            
            html += '<h3>Protein Structure (straight)</h3>';
            html += '<pre>' + ASCIIRenderer.renderProtein("S-E60-BA-RPF-C60") + '</pre>';
            
            html += '<h3>Protein Structure (with 60Â° bend at position 2)</h3>';
            html += '<pre>' + ASCIIRenderer.renderProteinWithBend("S-E60-BA-RPF-C60", 2, 60) + '</pre>';
            
            examples.innerHTML = html;
        }

        // Custom renderers
        function renderCustomDNA() {
            const top = document.getElementById('dna-top').value;
            const bottom = document.getElementById('dna-bottom').value;
            document.getElementById('dna-output').textContent = 
                ASCIIRenderer.renderDNA(top, bottom);
        }

        function renderCustomRNA() {
            const seq = document.getElementById('rna-seq').value;
            document.getElementById('rna-output').textContent = 
                ASCIIRenderer.renderRNA(seq);
        }

        function renderCustomRNABend() {
            const seq = document.getElementById('rna-seq').value;
            const bend = parseInt(document.getElementById('rna-bend').value);
            document.getElementById('rna-output').textContent = 
                ASCIIRenderer.renderRNAWithBend(seq, bend);
        }

        function renderCustomProtein() {
            const seq = document.getElementById('protein-seq').value;
            document.getElementById('protein-output').textContent = 
                ASCIIRenderer.renderProtein(seq);
        }

        function renderCustomProteinBend() {
            const seq = document.getElementById('protein-seq').value;
            const bend = parseInt(document.getElementById('protein-bend').value);
            const angle = parseInt(document.getElementById('protein-angle').value);
            document.getElementById('protein-output').textContent = 
                ASCIIRenderer.renderProteinWithBend(seq, bend, angle);
        }

        function renderCustomHexGrid() {
            try {
                const hexes = JSON.parse(document.getElementById('hex-input').value);
                document.getElementById('hex-output').textContent = 
                    ASCIIRenderer.renderHexGrid({ hexes: hexes });
            } catch (e) {
                document.getElementById('hex-output').textContent = 
                    'ERROR: Invalid JSON - ' + e.message;
            }
        }

        // Initialize
        runExamples();
    </script>
</body>
</html>
