<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Renderer Test</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a2e;
            color: #ffffff;
            padding: 20px;
            line-height: 1.6;
        }
        .output {
            background: #0f0f1e;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        h2 {
            color: #00ff88;
            margin-top: 30px;
        }
        pre {
            margin: 10px 0;
            white-space: pre;
        }
        .input-section {
            background: #16213e;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        input, textarea {
            font-family: 'Courier New', monospace;
            background: #0f0f1e;
            color: #ffffff;
            border: 1px solid #00ff88;
            padding: 8px;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
            margin: 5px 0;
        }
        button {
            background: #00ff88;
            color: #0f0f1e;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            margin: 5px 5px 5px 0;
        }
        button:hover {
            background: #00dd77;
        }
    </style>
</head>
<body>
    <h1>ðŸ§¬ ASCII Renderer Test</h1>
    <p>Quick visualization of molecular structures</p>

    <div class="output">
        <h2>Examples</h2>
        <div id="examples"></div>
    </div>

    <div class="input-section">
        <h2>Try Your Own</h2>
        
        <h3>DNA</h3>
        <label>Top Strand (3'â†’5'):</label>
        <input type="text" id="dna-top" value="ACGTACGT" />
        <label>Bottom Strand (5'â†’3'):</label>
        <input type="text" id="dna-bottom" value="TGCATGCA" />
        <button onclick="renderCustomDNA()">Render DNA</button>
        <pre id="dna-output"></pre>

        <h3>RNA</h3>
        <label>Sequence:</label>
        <input type="text" id="rna-seq" value="ACGUACGU" />
        <button onclick="renderCustomRNA()">Render RNA (Straight)</button>
        <label>Bend Position (0-indexed):</label>
        <input type="number" id="rna-bend" value="3" min="0" />
        <button onclick="renderCustomRNABend()">Render RNA (With Bend)</button>
        <pre id="rna-output"></pre>

        <h3>Protein</h3>
        <label>Amino Acid Sequence (use hyphens):</label>
        <input type="text" id="protein-seq" value="STR-EX6-BTA-BTG-RPF-CRL-CP6" />
        <button onclick="renderCustomProtein()">Render Protein (Straight)</button>
        <label>Bend Position (0-indexed):</label>
        <input type="number" id="protein-bend" value="3" min="0" />
        <label>Bend Angle:</label>
        <select id="protein-angle">
            <option value="60">60Â°</option>
            <option value="120">120Â°</option>
        </select>
        <button onclick="renderCustomProteinBend()">Render Protein (With Bend)</button>
        <pre id="protein-output"></pre>
    </div>

    <script>
        // ASCII Renderer - Fast text-based visualization of molecular structures
        class ASCIIRenderer {
            
            // Helper to format nucleotide with angle brackets
            static formatNucleotide(n) {
                return '<' + n + '>';
            }
            
            // Get hydrogen bond representation for base pair
            static getHBondSymbol(top, bottom) {
                // A-T has 2 hydrogen bonds: "||"
                // G-C has 3 hydrogen bonds: "|||"
                if ((top === 'A' && bottom === 'T') || (top === 'T' && bottom === 'A')) {
                    return '| |';
                } else if ((top === 'G' && bottom === 'C') || (top === 'C' && bottom === 'G')) {
                    return '|||';
                }
                return '|||'; // default
            }
            
            // Render DNA structure
            static renderDNA(topSequence, bottomSequence) {
                if (topSequence.length !== bottomSequence.length) {
                    return "ERROR: Top and bottom sequences must be same length";
                }
                
                const length = topSequence.length;
                
                // Build top line with directional markers
                let topBases = topSequence.split('').map(b => this.formatNucleotide(b)).join('-');
                let topLine = "3'-" + topBases + "-5'";
                
                // Build middle line with hydrogen bonds
                let middleLine = "   ";  // Offset for "3'-"
                for (let i = 0; i < length; i++) {
                    let bond = this.getHBondSymbol(topSequence[i], bottomSequence[i]);
                    middleLine += bond;
                    if (i < length - 1) {
                        middleLine += " ";  // 1 space between bonds
                    }
                }
                
                // Build bottom line with directional markers
                let bottomBases = bottomSequence.split('').map(b => this.formatNucleotide(b)).join('-');
                let bottomLine = "5'-" + bottomBases + "-3'";
                
                return topLine + '\n' + middleLine + '\n' + bottomLine;
            }
            
            // Render RNA structure (straight)
            static renderRNA(sequence) {
                let bases = sequence.split('').map(b => this.formatNucleotide(b)).join('-');
                return "5'-" + bases + "-3'";
            }
            
            // Render RNA with 60Â° bend
            static renderRNAWithBend(sequence, bendPosition) {
                if (bendPosition < 0 || bendPosition >= sequence.length - 1) {
                    return "ERROR: Invalid bend position";
                }
                
                let lines = [];
                
                // Before bend
                let beforeBend = sequence.substring(0, bendPosition + 1);
                let beforeBases = beforeBend.split('').map(b => this.formatNucleotide(b)).join('-');
                lines.push("5'-" + beforeBases);
                
                // Calculate indent (3 for "5'-" + 4 per base (<X>-))
                let baseIndent = "   " + " ".repeat(beforeBend.length * 4);
                
                // After bend (each base moves down and to the right)
                let afterBend = sequence.substring(bendPosition + 1);
                for (let i = 0; i < afterBend.length; i++) {
                    // Each successive base indents further right (4 chars per base)
                    let currentIndent = baseIndent + " ".repeat(i * 4);
                    
                    if (i === 0) {
                        lines.push(currentIndent + "\\");
                    }
                    
                    let formattedBase = this.formatNucleotide(afterBend[i]);
                    if (i === afterBend.length - 1) {
                        lines.push(currentIndent + " " + formattedBase + "-3'");
                    } else {
                        lines.push(currentIndent + " " + formattedBase);
                        lines.push(currentIndent + "    \\");
                    }
                }
                
                return lines.join('\n');
            }
            
            // Render protein structure (straight, unfolded)
            static renderProtein(aminoAcidSequence) {
                // aminoAcidSequence is like "STR-EX6-BTA-RPF-CP6"
                return "N-" + aminoAcidSequence + "-C";
            }
            
            // Render protein with bends
            static renderProteinWithBend(aminoAcidSequence, bendPosition, bendAngle) {
                const aminoAcids = aminoAcidSequence.split('-');
                
                if (bendPosition < 0 || bendPosition >= aminoAcids.length - 1) {
                    return "ERROR: Invalid bend position";
                }
                
                let lines = [];
                
                // Before bend
                let beforeBend = aminoAcids.slice(0, bendPosition + 1);
                lines.push("N-" + beforeBend.join('-'));
                
                // Calculate base indent
                let beforeBendStr = beforeBend.join('-');
                let baseIndent = "  " + " ".repeat(beforeBendStr.length + 1);
                
                // After bend (each amino acid moves down and to the right for 60Â°, left for 120Â°)
                let afterBend = aminoAcids.slice(bendPosition + 1);
                for (let i = 0; i < afterBend.length; i++) {
                    let currentIndent;
                    
                    if (bendAngle === 60) {
                        // 60Â° - move right
                        let additionalIndent = 0;
                        for (let j = 0; j < i; j++) {
                            additionalIndent += afterBend[j].length + 1;
                        }
                        currentIndent = baseIndent + " ".repeat(additionalIndent);
                    } else {
                        // 120Â° - move left
                        let totalWidth = 0;
                        for (let j = 0; j <= i; j++) {
                            totalWidth += afterBend[j].length + 1;
                        }
                        // Reduce indent as we go down
                        let reduction = totalWidth;
                        let newIndentLength = Math.max(0, baseIndent.length - reduction);
                        currentIndent = " ".repeat(newIndentLength);
                    }
                    
                    if (i === 0) {
                        if (bendAngle === 60) {
                            lines.push(currentIndent + "\\");
                        } else if (bendAngle === 120) {
                            lines.push(currentIndent + "/");
                        }
                    }
                    
                    if (i === afterBend.length - 1) {
                        lines.push(currentIndent + " " + afterBend[i] + "-C");
                    } else {
                        lines.push(currentIndent + " " + afterBend[i]);
                        let slashIndent = currentIndent + " " + " ".repeat(afterBend[i].length);
                        if (bendAngle === 60) {
                            lines.push(slashIndent + "\\");
                        } else {
                            lines.push(slashIndent + "/");
                        }
                    }
                }
                
                return lines.join('\n');
            }
            
            // Render hex grid structure (show q,r coordinates)
            static renderHexGrid(hexStructure) {
                // Find bounds
                let minQ = Infinity, maxQ = -Infinity;
                let minR = Infinity, maxR = -Infinity;
                
                for (const hex of hexStructure.hexes) {
                    minQ = Math.min(minQ, hex.q);
                    maxQ = Math.max(maxQ, hex.q);
                    minR = Math.min(minR, hex.r);
                    maxR = Math.max(maxR, hex.r);
                }
                
                let lines = [];
                
                // Build grid row by row
                for (let r = minR; r <= maxR; r++) {
                    let line = "";
                    
                    // Offset for hex grid
                    if (r % 2 === 1) {
                        line += "  ";
                    }
                    
                    for (let q = minQ; q <= maxQ; q++) {
                        const hex = hexStructure.hexes.find(h => h.q === q && h.r === r);
                        if (hex) {
                            line += hex.type + "   ";
                        } else {
                            line += ".   ";
                        }
                    }
                    
                    lines.push(line);
                }
                
                return lines.join('\n');
            }
        }

        // Run examples
        function runExamples() {
            const examples = document.getElementById('examples');
            
            // Clear existing content
            examples.innerHTML = '';
            
            // DNA Structure
            const dnaTitle = document.createElement('h3');
            dnaTitle.textContent = 'DNA Structure';
            examples.appendChild(dnaTitle);
            const dnaPre = document.createElement('pre');
            dnaPre.textContent = ASCIIRenderer.renderDNA("ACGT", "TGCA");
            examples.appendChild(dnaPre);
            
            // RNA Structure (straight)
            const rnaTitle = document.createElement('h3');
            rnaTitle.textContent = 'RNA Structure (straight)';
            examples.appendChild(rnaTitle);
            const rnaPre = document.createElement('pre');
            rnaPre.textContent = ASCIIRenderer.renderRNA("ACGUA");
            examples.appendChild(rnaPre);
            
            // RNA Structure (bent)
            const rnaBendTitle = document.createElement('h3');
            rnaBendTitle.textContent = 'RNA Structure (with 60Â° bend at position 2)';
            examples.appendChild(rnaBendTitle);
            const rnaBendPre = document.createElement('pre');
            rnaBendPre.textContent = ASCIIRenderer.renderRNAWithBend("ACGUA", 2);
            examples.appendChild(rnaBendPre);
            
            // Protein Structure (straight)
            const proteinTitle = document.createElement('h3');
            proteinTitle.textContent = 'Protein Structure (straight)';
            examples.appendChild(proteinTitle);
            const proteinPre = document.createElement('pre');
            proteinPre.textContent = ASCIIRenderer.renderProtein("STR-EX6-BTA-RPF-CP6");
            examples.appendChild(proteinPre);
            
            // Protein Structure (bent)
            const proteinBendTitle = document.createElement('h3');
            proteinBendTitle.textContent = 'Protein Structure (with 60Â° bend at position 2)';
            examples.appendChild(proteinBendTitle);
            const proteinBendPre = document.createElement('pre');
            proteinBendPre.textContent = ASCIIRenderer.renderProteinWithBend("STR-EX6-BTA-RPF-CP6", 2, 60);
            examples.appendChild(proteinBendPre);
        }

        // Custom renderers
        function renderCustomDNA() {
            const top = document.getElementById('dna-top').value;
            const bottom = document.getElementById('dna-bottom').value;
            document.getElementById('dna-output').textContent = 
                ASCIIRenderer.renderDNA(top, bottom);
        }

        function renderCustomRNA() {
            const seq = document.getElementById('rna-seq').value;
            document.getElementById('rna-output').textContent = 
                ASCIIRenderer.renderRNA(seq);
        }

        function renderCustomRNABend() {
            const seq = document.getElementById('rna-seq').value;
            const bend = parseInt(document.getElementById('rna-bend').value);
            document.getElementById('rna-output').textContent = 
                ASCIIRenderer.renderRNAWithBend(seq, bend);
        }

        function renderCustomProtein() {
            const seq = document.getElementById('protein-seq').value;
            document.getElementById('protein-output').textContent = 
                ASCIIRenderer.renderProtein(seq);
        }

        function renderCustomProteinBend() {
            const seq = document.getElementById('protein-seq').value;
            const bend = parseInt(document.getElementById('protein-bend').value);
            const angle = parseInt(document.getElementById('protein-angle').value);
            document.getElementById('protein-output').textContent = 
                ASCIIRenderer.renderProteinWithBend(seq, bend, angle);
        }

        function renderCustomHexGrid() {
            try {
                const hexes = JSON.parse(document.getElementById('hex-input').value);
                document.getElementById('hex-output').textContent = 
                    ASCIIRenderer.renderHexGrid({ hexes: hexes });
            } catch (e) {
                document.getElementById('hex-output').textContent = 
                    'ERROR: Invalid JSON - ' + e.message;
            }
        }

        // Initialize
        runExamples();
    </script>
</body>
</html>
