<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Renderer Test</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a2e;
            color: #ffffff;
            padding: 20px;
            line-height: 1.6;
        }
        .output {
            background: #0f0f1e;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        h2 {
            color: #00ff88;
            margin-top: 30px;
        }
        pre {
            margin: 10px 0;
            white-space: pre;
        }
        .input-section {
            background: #16213e;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        input, textarea {
            font-family: 'Courier New', monospace;
            background: #0f0f1e;
            color: #ffffff;
            border: 1px solid #00ff88;
            padding: 8px;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
            margin: 5px 0;
        }
        button {
            background: #00ff88;
            color: #0f0f1e;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            margin: 5px 5px 5px 0;
        }
        button:hover {
            background: #00dd77;
        }
    </style>
</head>
<body>
    <h1>ðŸ§¬ ASCII Renderer Test</h1>
    <p>Quick visualization of molecular structures</p>

    <div class="output">
        <h2>Examples</h2>
        <div id="examples"></div>
    </div>

    <div class="input-section">
        <h2>Try Your Own</h2>
        
        <h3>DNA</h3>
        <label>Top Strand (3'â†’5'):</label>
        <input type="text" id="dna-top" value="ACGTACGT" />
        <label>Bottom Strand (5'â†’3'):</label>
        <input type="text" id="dna-bottom" value="TGCATGCA" />
        <button onclick="renderCustomDNA()">Render DNA</button>
        <pre id="dna-output"></pre>

        <h3>RNA</h3>
        <label>Sequence:</label>
        <input type="text" id="rna-seq" value="ACGUACGU" />
        <button onclick="renderCustomRNA()">Render RNA (Straight)</button>
        <label>Bend Position (0-indexed):</label>
        <input type="number" id="rna-bend" value="3" min="0" />
        <button onclick="renderCustomRNABend()">Render RNA (With Bend)</button>
        <pre id="rna-output"></pre>

        <h3>Protein</h3>
        <label>Amino Acid Sequence (use hyphens):</label>
        <input type="text" id="protein-seq" value="STR-EX6-BTA-BTG-RPF-CRL-CP6" />
        <button onclick="renderCustomProtein()">Render Protein (Straight)</button>
        <label>Bend Position (0-indexed):</label>
        <input type="number" id="protein-bend" value="3" min="0" />
        <label>Bend Angle:</label>
        <select id="protein-angle">
            <option value="60">60Â°</option>
            <option value="120">120Â°</option>
        </select>
        <button onclick="renderCustomProteinBend()">Render Protein (With Bend)</button>
        <pre id="protein-output"></pre>
    </div>

    <script>
        // ASCII Renderer - Fast text-based visualization of molecular structures
        // CANONICAL VERSION - Synced with ascii-renderer.js
        class ASCIIRenderer {

            // Helper: Wrap RNA bases in <> brackets
            static wrapRNABases(sequence) {
                return sequence.split('').map(b => '<' + b + '>').join('-');
            }

            // Helper: Render a straight sequence (generic for RNA and proteins)
            static renderSequence(sequence, prefix, suffix) {
                return prefix + sequence + suffix;
            }

            // Helper: Render a sequence with a bend (generic for RNA and proteins)
            static renderSequenceWithBend(sequence, bendPosition, bendAngle, prefix, suffix) {
                const elements = sequence.split('-');

                if (bendPosition < 0 || bendPosition >= elements.length - 1) {
                    return "ERROR: Invalid bend position";
                }

                let lines = [];

                // Before bend
                let beforeBend = elements.slice(0, bendPosition + 1);
                let firstLine = prefix + beforeBend.join('-');
                lines.push(firstLine);

                // Determine bend character
                let bendChar = bendAngle === 60 ? "\\" : "/";

                // Calculate starting column: last character is at index (length - 1)
                let lastCharIndex = firstLine.length - 1;

                // After bend - position bend chars to point to centers of elements
                let afterBend = elements.slice(bendPosition + 1);

                // Find center position of last element before bend
                let lastElement = elements[bendPosition];
                let lastElementCenter = Math.floor(lastElement.length / 2);
                let prevCenterPos = lastCharIndex - lastElement.length + 1 + lastElementCenter;

                // First pass: calculate all positions to find minimum
                let positions = [];
                let tempPrevCenterPos = prevCenterPos;

                for (let i = 0; i < afterBend.length; i++) {
                    let currentElement = afterBend[i];
                    let elementCenter = Math.floor(currentElement.length / 2);

                    let bendCharPos, currentCenterPos, elementStartPos;

                    if (bendAngle === 60) {
                        bendCharPos = tempPrevCenterPos + 1;
                        currentCenterPos = bendCharPos + 1;
                        elementStartPos = currentCenterPos - elementCenter;
                    } else {
                        bendCharPos = tempPrevCenterPos - 1;
                        currentCenterPos = bendCharPos - 1;
                        elementStartPos = currentCenterPos - elementCenter;
                    }

                    positions.push({ bendCharPos, elementStartPos, element: currentElement, isLast: i === afterBend.length - 1 });
                    tempPrevCenterPos = currentCenterPos;
                }

                // Find minimum position
                let minPos = 0;
                for (let pos of positions) {
                    minPos = Math.min(minPos, pos.bendCharPos, pos.elementStartPos);
                }

                // Apply offset if needed (if minPos is negative, shift everything right)
                let offset = minPos < 0 ? -minPos : 0;

                // If we need to shift, also shift the first line
                if (offset > 0) {
                    lines[0] = " ".repeat(offset) + lines[0];
                }

                // Second pass: render with offset
                for (let pos of positions) {
                    let bendIndent = " ".repeat(pos.bendCharPos + offset);
                    let elementIndent = " ".repeat(pos.elementStartPos + offset);

                    lines.push(bendIndent + bendChar);

                    if (pos.isLast) {
                        lines.push(elementIndent + pos.element + suffix);
                    } else {
                        lines.push(elementIndent + pos.element);
                    }
                }

                return lines.join('\n');
            }

            // Render DNA structure with hex grid layout
            static renderDNA(topSequence, bottomSequence) {
                if (topSequence.length !== bottomSequence.length) {
                    return "ERROR: Top and bottom sequences must be same length";
                }

                const length = topSequence.length;

                // Build top line with directional markers and <> around bases
                let topLine = "5'-" + topSequence.split('').map(b => '<' + b + '>').join('-') + "-3'";

                // Build middle lines with vertical colons for hex grid spacing
                let middleLine = "    " + topSequence.split('').map(() => ':').join('   ');

                // Build bottom line with directional markers and <> around bases
                let bottomLine = "3'-" + bottomSequence.split('').map(b => '<' + b + '>').join('-') + "-5'";

                // Return with 3 rows of colons to show hex grid spacing
                return topLine + '\n' + middleLine + '\n' + middleLine + '\n' + middleLine + '\n' + bottomLine;
            }

            // Render RNA structure (straight)
            static renderRNA(sequence) {
                const wrappedSequence = this.wrapRNABases(sequence);
                return this.renderSequence(wrappedSequence, "5'-", "-3'");
            }

            // Render RNA with 60Â° bend
            static renderRNAWithBend(sequence, bendPosition) {
                const wrappedSequence = this.wrapRNABases(sequence);
                return this.renderSequenceWithBend(wrappedSequence, bendPosition, 60, "5'-", "-3'");
            }

            // Render protein structure (straight, unfolded)
            static renderProtein(aminoAcidSequence) {
                // aminoAcidSequence is like "STR-EX6-BTA-RPF-CP6"
                return this.renderSequence(aminoAcidSequence, "N-", "-C");
            }

            // Render protein with bends
            static renderProteinWithBend(aminoAcidSequence, bendPosition, bendAngle) {
                return this.renderSequenceWithBend(aminoAcidSequence, bendPosition, bendAngle, "N-", "-C");
            }

        }

        // Run examples
        function runExamples() {
            const examples = document.getElementById('examples');
            
            // Clear existing content
            examples.innerHTML = '';
            
            // DNA Structure
            const dnaTitle = document.createElement('h3');
            dnaTitle.textContent = 'DNA Structure';
            examples.appendChild(dnaTitle);
            const dnaPre = document.createElement('pre');
            dnaPre.textContent = ASCIIRenderer.renderDNA("ACGT", "TGCA");
            examples.appendChild(dnaPre);
            
            // RNA Structure (straight)
            const rnaTitle = document.createElement('h3');
            rnaTitle.textContent = 'RNA Structure (straight)';
            examples.appendChild(rnaTitle);
            const rnaPre = document.createElement('pre');
            rnaPre.textContent = ASCIIRenderer.renderRNA("ACGUA");
            examples.appendChild(rnaPre);
            
            // RNA Structure (bent)
            const rnaBendTitle = document.createElement('h3');
            rnaBendTitle.textContent = 'RNA Structure (with 60Â° bend at position 2)';
            examples.appendChild(rnaBendTitle);
            const rnaBendPre = document.createElement('pre');
            rnaBendPre.textContent = ASCIIRenderer.renderRNAWithBend("ACGUA", 2);
            examples.appendChild(rnaBendPre);
            
            // Protein Structure (straight)
            const proteinTitle = document.createElement('h3');
            proteinTitle.textContent = 'Protein Structure (straight)';
            examples.appendChild(proteinTitle);
            const proteinPre = document.createElement('pre');
            proteinPre.textContent = ASCIIRenderer.renderProtein("STR-EX6-BTA-RPF-CP6");
            examples.appendChild(proteinPre);
            
            // Protein Structure (bent)
            const proteinBendTitle = document.createElement('h3');
            proteinBendTitle.textContent = 'Protein Structure (with 60Â° bend at position 2)';
            examples.appendChild(proteinBendTitle);
            const proteinBendPre = document.createElement('pre');
            proteinBendPre.textContent = ASCIIRenderer.renderProteinWithBend("STR-EX6-BTA-RPF-CP6", 2, 60);
            examples.appendChild(proteinBendPre);
        }

        // Custom renderers
        function renderCustomDNA() {
            const top = document.getElementById('dna-top').value;
            const bottom = document.getElementById('dna-bottom').value;
            document.getElementById('dna-output').textContent = 
                ASCIIRenderer.renderDNA(top, bottom);
        }

        function renderCustomRNA() {
            const seq = document.getElementById('rna-seq').value;
            document.getElementById('rna-output').textContent = 
                ASCIIRenderer.renderRNA(seq);
        }

        function renderCustomRNABend() {
            const seq = document.getElementById('rna-seq').value;
            const bend = parseInt(document.getElementById('rna-bend').value);
            document.getElementById('rna-output').textContent = 
                ASCIIRenderer.renderRNAWithBend(seq, bend);
        }

        function renderCustomProtein() {
            const seq = document.getElementById('protein-seq').value;
            document.getElementById('protein-output').textContent = 
                ASCIIRenderer.renderProtein(seq);
        }

        function renderCustomProteinBend() {
            const seq = document.getElementById('protein-seq').value;
            const bend = parseInt(document.getElementById('protein-bend').value);
            const angle = parseInt(document.getElementById('protein-angle').value);
            document.getElementById('protein-output').textContent = 
                ASCIIRenderer.renderProteinWithBend(seq, bend, angle);
        }

        function renderCustomHexGrid() {
            try {
                const hexes = JSON.parse(document.getElementById('hex-input').value);
                document.getElementById('hex-output').textContent = 
                    ASCIIRenderer.renderHexGrid({ hexes: hexes });
            } catch (e) {
                document.getElementById('hex-output').textContent = 
                    'ERROR: Invalid JSON - ' + e.message;
            }
        }

        // Initialize
        runExamples();
    </script>
</body>
</html>
